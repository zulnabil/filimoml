{"version":3,"sources":["webpack:///./src/pages/train.js"],"names":["getMeanArray","arr","map","col","i","row","reduce","acc","c","length","Train","React","useState","files","setFiles","itemsRef","useRef","setDataStore","analyzer","setAnalyzer","mfccTotal","setMfccTotal","label","setLabel","useLayoutEffect","start","handleStopTrain","a","stop","value","curr","concat","console","log","fetch","method","headers","body","JSON","stringify","source","mfcc0","mfcc1","mfcc2","mfcc3","mfcc4","mfcc5","mfcc6","mfcc7","mfcc8","mfcc9","mfcc10","mfcc11","mfcc12","then","res","json","data","style","padding","type","multiple","onChange","event","Array","from","target","file","URL","createObjectURL","current","slice","placeholder","e","onClick","handleTrainAll","index","parseFloat","play","onended","key","ref","el","src","controls","onPlay","audioContext","AudioContext","createMediaElementSource","connect","destination","Meyda","createMeydaAnalyzer","bufferSize","featureExtractors","callback","features","mfcc","handleTrain","onEnded","margin"],"mappings":"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","file":"component---src-pages-train-js-3e025f9a9b5912ec7c3b.js","sourcesContent":["import React from \"react\"\nimport Meyda from \"meyda\"\n\nfunction getMeanArray(arr) {\n  let meanArr = arr[0].map((col, i) => {\n    return arr.map(row => row[i]).reduce((acc, c) => acc + c, 0) / arr.length\n  })\n  return meanArr\n}\n\n// const blob = window.URL || window.webkitURL\n\nfunction Train() {\n  const [files, setFiles] = React.useState([])\n  const [elRefs, setElRefs] = React.useState([])\n  const itemsRef = React.useRef([])\n  const [dataStore, setDataStore] = React.useState([])\n\n  const handleUpload = event => {\n    // event.preventDefault()\n    Array.from(event.target.files).map(file => {\n      setFiles(curr => curr.concat(URL.createObjectURL(file)))\n    })\n    itemsRef.current = itemsRef.current.slice(0, event.target.files.length)\n    // setElRefs(elRefs =>\n    //   Array.from(event.target.files).map((_, i) => elRefs[i] || createRef())\n    // )\n  }\n\n  const [analyzer, setAnalyzer] = React.useState(null)\n  const [mfccTotal, setMfccTotal] = React.useState([])\n  const [label, setLabel] = React.useState(\"\")\n\n  const handleTrain = i => {\n    setMfccTotal([])\n    const audioContext = new AudioContext()\n    // console.log(itemsRef.current[i])\n    const source = audioContext.createMediaElementSource(itemsRef.current[i])\n    source.connect(audioContext.destination)\n    setAnalyzer(\n      Meyda.createMeydaAnalyzer({\n        audioContext: audioContext,\n        source: source,\n        bufferSize: 512,\n        featureExtractors: [\"mfcc\"],\n        callback: features => {\n          setMfccTotal(curr => curr.concat([features.mfcc]))\n        },\n      })\n    )\n    // analyzer.start()\n  }\n\n  React.useLayoutEffect(() => {\n    if (analyzer) {\n      analyzer.start()\n    }\n  }, [analyzer])\n\n  const handleStopTrain = async (i) => {\n    analyzer.stop()\n    let value = await getMeanArray(mfccTotal)\n    setDataStore(curr => curr.concat([value]))\n    console.log(i+1)\n    console.log(value)\n    setMfccTotal([])\n\n    console.log(\"Mengupload fitur MFCC...\")\n      fetch(`https://filimoml.com/speeches/add`, {\n        method: \"post\",\n        headers: {\n          \"Content-type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          source: 'berlin',\n          mfcc0: value[0],\n          mfcc1: value[1],\n          mfcc2: value[2],\n          mfcc3: value[3],\n          mfcc4: value[4],\n          mfcc5: value[5],\n          mfcc6: value[6],\n          mfcc7: value[7],\n          mfcc8: value[8],\n          mfcc9: value[9],\n          mfcc10: value[10],\n          mfcc11: value[11],\n          mfcc12: value[12],\n          label,\n        }),\n      })\n        .then(res => res.json())\n        .then(data => console.log(data))\n  }\n\n  const handleTrainAll = (index = 0) => {\n    // for (let i in files) {\n      console.log(\n        `[${parseFloat(index) + 1}/${files.length}] Mengekstrak fitur MFCC`\n      )\n      itemsRef.current[index].play()\n      // if (itemsRef.current[i].ended) {\n      //   console.log('end')\n      // }\n      itemsRef.current[index].onended = function() {\n        if (index < (files.length-1)) {\n          handleTrainAll(index+1)\n        }\n      }\n      // itemsRef.current[i].addEventListener('play', () => {\n      //   itemsRef.current[i].addEventListener('ended', console.log('asw'))\n      // })\n      // await sleep(itemsRef.current[i].duration * 1000 + 100)\n    // }\n  }\n\n  // React.useLayoutEffect(() => {\n  //   if (files.length > 0 && files.length === dataStore.length) {\n  //     console.log(dataStore)\n  //     console.log(\"Mengupload fitur MFCC...\")\n  //     fetch(`http://localhost:5000/speeches/add`, {\n  //       method: \"post\",\n  //       headers: {\n  //         \"Content-type\": \"application/json\",\n  //       },\n  //       body: JSON.stringify({\n  //         data: dataStore['0'],\n  //         label,\n  //         source: 'ravdess'\n  //       }),\n  //     })\n  //       .then(res => res.json())\n  //       .then(data => console.log(data))\n  //   }\n  // }, [dataStore])\n\n\n  return (\n    <div style={{ padding: 50 }}>\n      <input type=\"file\" multiple onChange={handleUpload} />\n      <input\n        type=\"text\"\n        placeholder=\"Label emosi\"\n        onChange={e => setLabel(e.target.value)}\n      />\n      <button onClick={() => handleTrainAll()}>Train</button>\n      <br />\n      {files\n        ? files.map((file, i) => {\n            return (\n              <audio\n                key={i}\n                ref={el => (itemsRef.current[i] = el)}\n                src={file}\n                controls\n                onPlay={() => handleTrain(i)}\n                onEnded={() => handleStopTrain(i)}\n                style={{ margin: 15 }}\n              />\n            )\n          })\n        : null}\n    </div>\n  )\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport default Train\n"],"sourceRoot":""}